(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{420:function(t,a,s){"use strict";s.r(a);var r=s(19),e=Object(r.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"dsbridge"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dsbridge","aria-hidden":"true"}},[t._v("#")]),t._v(" dsBridge")]),t._v(" "),s("h2",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍","aria-hidden":"true"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),s("p",[t._v("官方地址："),s("a",{attrs:{href:"https://github.com/wendux/DSBridge-Android/blob/master/readme-chs.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wendux/DSBridge-Android/blob/master/readme-chs.md"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("三端易用的现代跨平台 Javascript bridge， 通过它，你可以在Javascript和原生之间同步或异步的调用彼此的函数.")]),t._v(" "),s("h2",{attrs:{id:"javascript-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#javascript-api","aria-hidden":"true"}},[t._v("#")]),t._v(" JavaScript API")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" dsBridge"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dsbridge"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//同步调用")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" str"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dsBridge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testSyn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testSyn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//异步调用")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dsBridge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testAsyn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testAsyn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("v")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//注册 javascript API")]),t._v("\n dsBridge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'addValue'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("l"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("r")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" l"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//注册 javascript API")]),t._v("\n dsBridge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerAsyn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'addValue'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("l"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("r")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" l"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"jsbridge原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jsbridge原理","aria-hidden":"true"}},[t._v("#")]),t._v(" JsBridge原理")]),t._v(" "),s("p",[t._v("JavaScript 是运行在一个单独的 JS Context 中（例如，WebView 的 Webkit 引擎、JSCore）。由于这些 Context 与原生运行环境的天然隔离，我们可以将这种情况与 RPC（Remote Procedure Call，远程过程调用）通信进行类比，将 Native 与 JavaScript 的每次互相调用看做一次 RPC 调用。\n在 JSBridge 的设计中，可以把前端看做 RPC 的客户端，把 Native 端看做 RPC 的服务器端，从而 JSBridge 要实现的主要逻辑就出现了：通信调用（Native 与 JS 通信） 和 句柄解析调用。（如果你是个前端，而且并不熟悉 RPC 的话，你也可以把这个流程类比成 JSONP 的流程）\n通过以上的分析，可以清楚地知晓 JSBridge 主要的功能和职责，接下来就以 Hybrid 方案 为案例从这几点来剖析 JSBridge 的实现原理。")]),t._v(" "),s("h3",{attrs:{id:"javascript-调用-native"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#javascript-调用-native","aria-hidden":"true"}},[t._v("#")]),t._v(" JavaScript 调用 Native")]),t._v(" "),s("p",[t._v("avaScript 调用 Native 的方式，主要有两种：注入 API 和 拦截 URL SCHEME。")]),t._v(" "),s("h4",{attrs:{id:"注入api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注入api","aria-hidden":"true"}},[t._v("#")]),t._v(" 注入API")]),t._v(" "),s("p",[t._v("注入 API 方式的主要原理是，通过 WebView 提供的接口，向 JavaScript 的 Context（window）中注入对象或者方法，让 JavaScript 调用时，直接执行相应的 Native 代码逻辑，达到 JavaScript 调用 Native 的目的。")]),t._v(" "),s("h4",{attrs:{id:"拦截-url-scheme"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拦截-url-scheme","aria-hidden":"true"}},[t._v("#")]),t._v(" 拦截 URL SCHEME")]),t._v(" "),s("p",[t._v("先解释一下 URL SCHEME：URL SCHEME是一种类似于url的链接，是为了方便app直接互相调用设计的，形式和普通的 url 近似，主要区别是 protocol 和 host 一般是自定义的，例如: qunarhy://hy/url?url=ymfe.tech，protocol 是 qunarhy，host 则是 hy。\n拦截 URL SCHEME 的主要流程是：Web 端通过某种方式（例如 iframe.src）发送 URL Scheme 请求，之后 Native 拦截到请求并根据 URL SCHEME（包括所带的参数）进行相关操作。\n在时间过程中，这种方式有一定的 缺陷：")]),t._v(" "),s("p",[t._v("使用 iframe.src 发送 URL SCHEME 会有 url 长度的隐患。")]),t._v(" "),s("p",[t._v("创建请求，需要一定的耗时，比注入 API 的方式调用同样的功能，耗时会较长。\n但是之前为什么很多方案使用这种方式呢？因为它 支持 iOS6。而现在的大环境下，iOS6 占比很小，基本上可以忽略，所以并不推荐为了 iOS6 使用这种 并不优雅 的方式。")]),t._v(" "),s("h3",{attrs:{id:"native-调用-javascript"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#native-调用-javascript","aria-hidden":"true"}},[t._v("#")]),t._v(" Native 调用 JavaScript")]),t._v(" "),s("p",[t._v("相比于 JavaScript 调用 Native， Native 调用 JavaScript 较为简单，毕竟不管是 iOS 的 UIWebView 还是 WKWebView，还是 Android 的 WebView 组件，都以子组件的形式存在于 View/Activity 中，直接调用相应的 API 即可。\nNative 调用 JavaScript，其实就是执行拼接 JavaScript 字符串，从外部调用 JavaScript 中的方法，因此 JavaScript 的方法必须在全局的 window 上。（闭包里的方法，JavaScript 自己都调用不了，更不用想让 Native 去调用了）")]),t._v(" "),s("h3",{attrs:{id:"jsbridge-如何引用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jsbridge-如何引用","aria-hidden":"true"}},[t._v("#")]),t._v(" JSBridge 如何引用")]),t._v(" "),s("h4",{attrs:{id:"由-native-端进行注入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#由-native-端进行注入","aria-hidden":"true"}},[t._v("#")]),t._v(" 由 Native 端进行注入")]),t._v(" "),s("p",[t._v("注入方式和 Native 调用 JavaScript 类似，直接执行桥的全部代码。\n它的优点在于：桥的版本很容易与 Native 保持一致，Native 端不用对不同版本的 JSBridge 进行兼容；与此同时，它的缺点是：注入时机不确定，需要实现注入失败后重试的机制，保证注入的成功率，同时 JavaScript 端在调用接口时，需要优先判断 JSBridge 是否已经注入成功。")]),t._v(" "),s("h4",{attrs:{id:"由-javascript-端引用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#由-javascript-端引用","aria-hidden":"true"}},[t._v("#")]),t._v(" 由 JavaScript 端引用")]),t._v(" "),s("p",[t._v("直接与 JavaScript 一起执行。\n与由 Native 端注入正好相反，它的优点在于：JavaScript 端可以确定 JSBridge 的存在，直接调用即可；缺点是：如果桥的实现方式有更改，JSBridge 需要兼容多版本的 Native Bridge 或者 Native Bridge 兼容多版本的 JSBridge。")]),t._v(" "),s("h2",{attrs:{id:"参考文献"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文献","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考文献")]),t._v(" "),s("ul",[s("li",[t._v("DsBridge："),s("a",{attrs:{href:"https://github.com/wendux/DSBridge-Android/blob/master/readme-chs.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/wendux/DSBridge-Android/blob/master/readme-chs.md"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("JSBridge的原理："),s("a",{attrs:{href:"https://juejin.im/post/5abca877f265da238155b6bc",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://juejin.im/post/5abca877f265da238155b6bc"),s("OutboundLink")],1)])])])},[],!1,null,null,null);a.default=e.exports}}]);